<<<<<<< HEAD
---
title: "Super Awesome Project Template"
output: word_document
date: "2023-03-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One Julia

```{r student1}
library(rvest)
#remove slash and everything behind it
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)

#remove quotation marks
TopSongs$Title<-gsub('"', '', TopSongs$Title)

#new data frame with dashes instead of spaces for url purposes
TopSongs2 <- sapply(TopSongs, function(x) gsub(" ", "-", x))
```


## Section Two Tessa
```{r student2}
library(rvest)
library(stringr)

songs_for_azlyrics <- as.data.frame(sapply(TopSongs, function(x) {
  lowercase_title <- tolower(gsub("\\s+", "", x)) # make names lower case for url
}))
songs_for_azlyrics$Artist <- gsub("^the", "", songs_for_azlyrics$Artist)

# Purpose: To generate the lyrics for each song in our top song data frame from the azlyrics.com website
# The function inputs (arguments): the function takes in an artist and title of a song
# The function output (return value(s)): the function returns the lyrics to the song inputted in the function.
generate_azlyrics <- function(artist, title) {
  azlyric_url <- paste0("https://www.azlyrics.com/lyrics/", artist, "/", title, ".html")
  html <- read_html(azlyric_url)
  lyrics_node <- html_nodes(html, xpath = "//div[@class='ringtone']//following-sibling::div")
  lyrics <- html_text(lyrics_node)
  lyrics <- gsub("\r|\n", " ", lyrics) #replace newline with space
  lyrics <- str_trim(lyrics) # trim white space
  lyrics_only <-trimws(strsplit(lyrics, "\n")[[1]][1]) # keep only lyrics only, path picks up extra content
  return(lyrics_only)
}

#empty df:
az_song_lyrics <- data.frame(Artist = character(), Title = character(), Lyrics = character(), stringsAsFactors = FALSE)

for (i in 1:nrow(songs_for_azlyrics)) {
  artist <- songs_for_azlyrics$Artist[i]
  title <- songs_for_azlyrics$Title[i]
  lyrics <- generate_azlyrics(artist, title)  
  new_row <- data.frame(artist = artist,
                        title = title,
                        lyrics = lyrics,
                        stringsAsFactors = FALSE)

  az_song_lyrics <- rbind(az_song_lyrics, new_row)
}
# gets to 10th iteration and scrape path must change? 
```

## Section Three Eva

```{r student3}
TopSongs2 <- as.data.frame(TopSongs2)
TopSongs2$Title <- sub("-$", "", TopSongs2$Title)
TopSongs2$Title <- gsub("[,.]", "", TopSongs2$Title)
TopSongs2$Artist <- gsub("\\.", "", TopSongs2$Artist)

scrape_lyrics <- function(df) {
  lyrics <- character(nrow(df))  
  for (i in 1:nrow(df)) {
    url <- paste0("https://www.songlyrics.com/", df$Artist[i], "/", df$Title[i], "-lyrics/")
    tryCatch({
      html <- read_html(url)
      raw_lyrics <- html_nodes(html, "#songLyricsDiv") %>% html_text() %>% as.character()
      lyrics[i] <- paste(raw_lyrics, collapse = " ")
    }, error = function(e) {
    })
  }
  df$lyrics <- lyrics  
  return(df)
}
TopSongs2 <- scrape_lyrics(TopSongs2)
```


## Section Four Sophie 

```{r student4}

urlfunction <- function(year) {
  if (year == 1958 || (year >= 2012 && year <= 2023)) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Billboard_number-one_country_songs_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, "td:nth-child(3) .fn a , th+ td > a")
  }else if (year >= 1959 && year <= 1961){
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_C%26W_Sides_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter span a , .jquery-tablesorter th a")
  }else if (year >= 1962 && year <= 1989) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".fn a , td > a")
  }else if (year >= 1990 && year <= 2004) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_%26_Tracks_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }else { 
    country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Songs_number_ones_of_",  year)
    html <- read_html(country_url)
    cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }  

  html_text(cast, trim = TRUE) 
  tables <- html_table(html, fill = TRUE, header = TRUE)
  desired_table <- tables[[1]]
  desired_table <- desired_table[, c(2, 3)]
    #include only the second and third columns which are title and artist
  if ("Title" %in% desired_table[1, ]) {
    desired_table <- desired_table[-1, ]
    #get rid of top row if they have an extra header row
          }
  colnames(desired_table) <- c("Title", "Artist")
    #name columns
  desired_table$Year <- year
     #add columns for year
  desired_table$genre <- "Country" 
     #add column for genre
  desired_table <- unique(desired_table)
    #get rid of repeat columns
  return(desired_table)
      
}
TopSongs <- data.frame()
for(year in 1958:2023){
    current_year <- urlfunction(year)
    TopSongs <- rbind(TopSongs, current_year)
}
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)
TopSongs$Title<-gsub('"', '', TopSongs$Title)
Topsongs2 <- replace(TopSongs," " , "-")

lyrics <- function(title, artist) {
lyric_url <- paste0("https://www.songlyrics.com/", artist, "/", title,"-lyrics/")
html <- read_html(lyric_url)
cast <- html_nodes(html, "#songLyricsDiv")
}
TopSongs2 <- sapply(TopSongs, function(x) gsub(" ", "-", x))
lyrics(let-her-cry, hootie-the-blowfish)
```
