<<<<<<< HEAD
---
title: "Super Awesome Project Template"
output: word_document
date: "2023-03-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One Julia

```{r student1}
library(rvest)

#get rid of the dashes and make them spaces
TopSongs3$Title <- gsub("-", " ", TopSongs3$Title)
TopSongs3$Artist <- gsub("-", " ", TopSongs3$Artist)

#change title and artist to all lower case
TopSongs3$Title<-tolower(TopSongs3$Title)
TopSongs3$Artist<-tolower(TopSongs3$Artist)


#save it as a csv file to working directory
write.csv(TopSongs3, "TopCountry.csv", row.names = FALSE)

#call it to test that it works and reads it correctly
TopCountry<-read.csv("TopCountry.csv")

```


## Section Two Tessa 
```{r student2}
library(rvest)
library(stringr)
library(tidytext)
library(dplyr)
library(stopwords)

lyric_uniqueness <- function(song_lyrics) {
  # initalize empty vector to hold words
  all_words <- c() 
  stop_words <-stopwords("en") # initalize english stopwords from stopswords package
  
  for (lyrics in song_lyrics) {
    # words <- unlist(strsplit(lyrics, "\\W+")) 
    words <- unlist(strsplit(lyrics, "\\s+")) #splits word at whitespace
    words <-words[!words %in% stop_words] # remove stop words
    all_words <-c(all_words, words) 
  }
  unique_words <-unique(all_words) # removes duplicate words
  freq <-table(all_words) # counts how many times each word shows up
  
  # make data frame with all the words and their frequency
  unique_df <- data.frame(Words = names(freq), Frequency = as.numeric(freq))
  return(unique_df)
}

result <-lyric_uniqueness(TopCountry$lyrics)

# shows words that show up 50 or more times
result_50 <- result[result$Frequency >= 50, ]
result_50



unique_words_ratio <- function(song_lyrics) {
  # make lyrics into single words
  token_lyrics <- song_lyrics %>%
    unnest_tokens(words, lyrics) 
  
  # find total number of words, then number of unique words using 
  total_words <-nrow(token_lyrics)
  unique_words <- token_lyrics %>%
    distinct(words) %>%
    nrow()
  
  #calculate ratio of unique words compared to all words
  ratio <- unique_words / total_words

  cat("Total number of words:", total_words, "\n")
  cat("Number of unique words:", unique_words, "\n")
  cat("Ratio of unique words to total words:", ratio, "\n")
  
}

unique_words_ratio(TopCountry) 

```

## Section Three Eva

```{r student3}
# Modify artist and title names
TopSongs2 <- as.data.frame(TopSongs2)
TopSongs2$Title <- sub("-$", "", TopSongs2$Title)
TopSongs2$Title <- gsub("[,.?%()]", "", TopSongs2$Title)
TopSongs2$Artist <- gsub("[.']", "", TopSongs2$Artist)
TopSongs2$Artist <- sub("-and", "", TopSongs2$Artist)

# Function to scrape lyrics
scrape_lyrics <- function(df) {
  lyrics <- character(nrow(df))  
  for (i in 1:nrow(df)) {
    url <- paste0("https://www.songlyrics.com/", df$Artist[i], "/", df$Title[i], "-lyrics/")
    # Tests for errors when getting URLs and makes sure code keeps running after an error occurs
    tryCatch({
      html <- read_html(url)
      raw_lyrics <- html_nodes(html, "#songLyricsDiv") %>% html_text() %>% as.character()
      lyrics[i] <- paste(raw_lyrics, collapse = " ")
    }, error = function(e) {
    })
  }
  df$lyrics <- lyrics  
  return(df)
}
# Apply function to our data frame
TopSongs2 <- scrape_lyrics(TopSongs2)
```

```{r}
# Modifies song lyrics to match
TopSongs2$lyrics <- gsub("\n", " ", TopSongs2$lyrics)
TopSongs2$lyrics <- gsub("[,.()]", "", TopSongs2$lyrics)
TopSongs2$lyrics <- tolower(TopSongs2$lyrics)
# Remove rows with missing lyrics
TopSongs2 <- subset(TopSongs2, !(is.na(lyrics) | lyrics == ""))
TopSongs2 <- subset(TopSongs2, !grepl("we do not have the lyrics for", lyrics))

```


## Section Four Sophie 

```{r student4}
alcohol <- c("whiskey", "moonshine", "beer", "wine", "tequila", "vodka", "jack daniels", "budlight", "coorslight", "busch", "alcohol", "rum", "gin", "brandy", "cognac", "schnapps", "absinthe", "champagne", "sake")
intimacy <- c("sexy", "hot", "sex", "attractive", "baby", "babe", "lover", "sweetheart", "passion", "desire", "romance", "affection", "intimacy", "seductive", "lust")
family <- c("mom", "mama", "granny", "marriage", "children", "marry", "wife", "husband", "dogs", "father", "daddy", "grandpa", "grandmother", "aunt", "uncle", "cousin", "siblings", "in-laws", "offspring")
drugs <- c("coke", "cocane", "tabacco", "weed", "heroin", "methamphetamine", "LSD", "ecstasy", "prescription drugs", "opioids", "hallucinogens", "MDMA", "smoke", "smoking")
guns <- c("gun", "guns", "revolver", "shotgun", "rifle", "pistol", "firearm", "ammunition", "sniper", "handgun", "arsenal")
music <- c("melody", "rhythm", "harmony", "lyrics", "genre", "beat", "album", "artist", "band", "guitar")
sad <- c("heartbreak", "sorrow", "grief", "despair", "melancholy", "misery", "anguish", "heartache", "depression", "tears")
countylivin <- c("cowboy", "horse", "truck", "pickup", "road", "tea", "tractor", "barn", "ranch", "cattle", "hay", "pasture", "cowboy boots", "western", "yeehaw", "rodeo")
town <- c("small town", "hometown", "back home", "home", "village", "community", "neighborhood", "suburb", "township", "locality", "settlement")
swear <- c("hell", "damn", "fuck", "bitch", "bitch", "ass", "asshole", "bastard", "shit", "bloody", "hellfire", "motherfucker", "crap", "piss", "bollocks", "wanker", "bugger")

alcohol_count <- 0
intimacy_count <- 0
family_count <- 0
drugs_count <- 0
guns_count <- 0
music_count <- 0
sad_count <- 0
countylivin_count <- 0
town_count <- 0
swear_count <- 0

# Loop through each row of the lyrics column in Topsongs2
for (lyric in TopSongs2$lyrics) {
  # Check if any word from each vector is present in the lyrics
  if (any(grepl(paste(alcohol, collapse = "|"), lyric, ignore.case = TRUE))) {
    alcohol_count <- alcohol_count + 1
  }
  if (any(grepl(paste(intimacy, collapse = "|"), lyric, ignore.case = TRUE))) {
    intimacy_count <- intimacy_count + 1
  }
  if (any(grepl(paste(family, collapse = "|"), lyric, ignore.case = TRUE))) {
    family_count <- family_count + 1
  }
  if (any(grepl(paste(drugs, collapse = "|"), lyric, ignore.case = TRUE))) {
    drugs_count <- drugs_count + 1
  }
  if (any(grepl(paste(guns, collapse = "|"), lyric, ignore.case = TRUE))) {
    guns_count <- guns_count + 1
  }
  if (any(grepl(paste(music, collapse = "|"), lyric, ignore.case = TRUE))) {
    music_count <- music_count + 1
  }
  if (any(grepl(paste(sad, collapse = "|"), lyric, ignore.case = TRUE))) {
    sad_count <- sad_count + 1
  }
  if (any(grepl(paste(countylivin, collapse = "|"), lyric, ignore.case = TRUE))) {
    countylivin_count <- countylivin_count + 1
  }
  if (any(grepl(paste(town, collapse = "|"), lyric, ignore.case = TRUE))) {
    town_count <- town_count + 1
  }
  if (any(grepl(paste(swear, collapse = "|"), lyric, ignore.case = TRUE))) {
    swear_count <- swear_count + 1
  }
}

# Create a data frame to store the counts
total_counts <- data.frame(
  vector = c("Alcohol", "Intimacy", "Family", "Drugs", "Guns", "Music", "Sad", "Country Living", "Town", "Swear"),
  count = c(alcohol_count, intimacy_count, family_count, drugs_count, guns_count, music_count, sad_count, countylivin_count, town_count, swear_count)
)


# Create a bar chart using ggplot
ggplot(total_counts, aes(x = vector, y = count)) +
  geom_bar(stat = "identity") +
  labs(x = "Vector", y = "Total Count of Songs") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```




```{r}

#Sophies#####
#Use URLs to get song titles, artists, and dates
urlfunction <- function(year) {
  if (year == 1958 || (year >= 2012 && year <= 2023)) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Billboard_number-one_country_songs_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, "td:nth-child(3) .fn a , th+ td > a")
  }else if (year >= 1959 && year <= 1961){
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_C%26W_Sides_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter span a , .jquery-tablesorter th a")
  }else if (year >= 1962 && year <= 1989) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".fn a , td > a")
  }else if (year >= 1990 && year <= 2004) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_%26_Tracks_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }else { 
    country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Songs_number_ones_of_",  year)
    html <- read_html(country_url)
    cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }  

  html_text(cast, trim = TRUE) 
  tables <- html_table(html, fill = TRUE, header = TRUE)
  desired_table <- tables[[1]]
  desired_table <- desired_table[, c(2, 3)]
    #include only the second and third columns which are title and artist
  if ("Title" %in% desired_table[1, ]) {
    desired_table <- desired_table[-1, ]
    #get rid of top row if they have an extra header row
          }
  colnames(desired_table) <- c("Title", "Artist")
    #name columns
  desired_table$Year <- year
     #add columns for year
  desired_table$genre <- "Country" 
     #add column for genre
  desired_table <- unique(desired_table)
    #get rid of repeat columns
  return(desired_table)
      
}
TopSongs <- data.frame()
for(year in 1958:2023){
    current_year <- urlfunction(year)
    TopSongs <- rbind(TopSongs, current_year)
}
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)
TopSongs$Title<-gsub('"', '', TopSongs$Title)

lyrics <- function(title, artist) {
lyric_url <- paste0("https://www.songlyrics.com/", artist, "/", title,"-lyrics/")
html <- read_html(lyric_url)
cast <- html_nodes(html, "#songLyricsDiv")
}


#Julia#####

#remove slash and everything behind it
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)

#remove quotation marks
TopSongs$Title<-gsub('"', '', TopSongs$Title)

#new data frame with dashes instead of spaces for url purposes
TopSongs2 <- sapply(TopSongs, function(x) gsub(" ", "-", x))



#EVA####
# Modify artist and title names
TopSongs2 <- as.data.frame(TopSongs2)
TopSongs2$Title <- sub("-$", "", TopSongs2$Title)
TopSongs2$Title <- gsub("[,.?%()]", "", TopSongs2$Title)
TopSongs2$Artist <- gsub("[.']", "", TopSongs2$Artist)
TopSongs2$Artist <- sub("-and", "", TopSongs2$Artist)

```

```{r}
#EVA######
# Function to scrape lyrics
scrape_lyrics <- function(df) {
  lyrics <- character(nrow(df))  
  for (i in 1:nrow(df)) {
    url <- paste0("https://www.songlyrics.com/", df$Artist[i], "/", df$Title[i], "-lyrics/")
    # Tests for errors when getting URLs and makes sure code keeps running after an error occurs
    tryCatch({
      html <- read_html(url)
      raw_lyrics <- html_nodes(html, "#songLyricsDiv") %>% html_text() %>% as.character()
      lyrics[i] <- paste(raw_lyrics, collapse = " ")
    }, error = function(e) {
    })
  }
  df$lyrics <- lyrics  
  return(df)
}
# Apply function to our data frame
TopSongs3 <- scrape_lyrics(TopSongs2)
```

```{r}
###EVA#####
# Modifies song lyrics to match
TopSongs3$lyrics <- gsub("\n", " ", TopSongs3$lyrics)
TopSongs3$lyrics <- gsub("[,.()]", "", TopSongs3$lyrics)
TopSongs3$lyrics <- tolower(TopSongs3$lyrics)
# Remove rows with missing lyrics
TopSongs3 <- subset(TopSongs3, !(is.na(lyrics) | lyrics == ""))
TopSongs3 <- subset(TopSongs3, !grepl("we do not have the lyrics for", lyrics))



##JULIA###
#getting rid of duplicate songs
unique <- TopSongs3[!duplicated(TopSongs3$Title), ]



```







