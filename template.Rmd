<<<<<<< HEAD
---
title: "Super Awesome Project Template"
output: word_document
date: "2023-03-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One Julia

```{r student1}
library(rvest)
#remove slash and everything behind it
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)

#remove quotation marks
TopSongs$Title<-gsub('"', '', TopSongs$Title)

#new data frame with dashes instead of spaces for url purposes
TopSongs2 <- sapply(TopSongs, function(x) gsub(" ", "-", x))


#getting rid of duplicate songs
unique <- TopSongs2[!duplicated(TopSongs2$Title), ]



```


## Section Two Tessa 
```{r student2}
library(rvest)
library(stringr)

lyric_repetitiveness <- function(lyrics) {
  words <- unlist(strsplit(lyrics, "\\W+"))
  repetitive_phrases_df <- data.frame( Phrase = character(), Frequency = numeric())
  # Find repetitive phrases of length 3 or more
  for (n in seq(3, length(words))) {
    # Generate n-grams - What are n grams?
    ngrams <-sapply(seq_along(words), function(i)
        paste(words[i:min(i + n - 1, length(words))], collapse = " "))
    ngram_freq <- table(ngrams)
    frequent_ngrams <- ngram_freq[ngram_freq >= 3]
    if (length(frequent_ngrams) > 0) {
      frequent_ngrams_df <- data.frame(Phrase = names(frequent_ngrams), Frequency = as.numeric(frequent_ngrams))
      repetitive_phrases_df <- rbind(repetitive_phrases_df, frequent_ngrams_df)
    }
  }
  
  repetitive_phrases_df <- unique(repetitive_phrases_df)
  repetitiveness <- 1 - length(unique(words)) / length(words)
  return(list(repetitiveness = repetitiveness, repetitive_phrases = repetitive_phrases_df))
}

y <- TopSongs2$lyrics[1]
y
lyric_repetitiveness(y)

```

## Section Three Eva

```{r student3}
# Modify artist and title names
TopSongs2 <- as.data.frame(TopSongs2)
TopSongs2$Title <- sub("-$", "", TopSongs2$Title)
TopSongs2$Title <- gsub("[,.?%()]", "", TopSongs2$Title)
TopSongs2$Artist <- gsub("[.']", "", TopSongs2$Artist)
TopSongs2$Artist <- sub("-and", "", TopSongs2$Artist)

# Function to scrape lyrics
scrape_lyrics <- function(df) {
  lyrics <- character(nrow(df))  
  for (i in 1:nrow(df)) {
    url <- paste0("https://www.songlyrics.com/", df$Artist[i], "/", df$Title[i], "-lyrics/")
    # Tests for errors when getting URLs and makes sure code keeps running after an error occurs
    tryCatch({
      html <- read_html(url)
      raw_lyrics <- html_nodes(html, "#songLyricsDiv") %>% html_text() %>% as.character()
      lyrics[i] <- paste(raw_lyrics, collapse = " ")
    }, error = function(e) {
    })
  }
  df$lyrics <- lyrics  
  return(df)
}
# Apply function to our data frame
TopSongs2 <- scrape_lyrics(TopSongs2)
```

```{r}
# Modifies song lyrics to match
TopSongs2$lyrics <- gsub("\n", " ", TopSongs2$lyrics)
TopSongs2$lyrics <- gsub("[,.()]", "", TopSongs2$lyrics)
TopSongs2$lyrics <- tolower(TopSongs2$lyrics)
# Remove rows with missing lyrics
TopSongs2 <- subset(TopSongs2, !(is.na(lyrics) | lyrics == ""))
TopSongs2 <- subset(TopSongs2, !grepl("we do not have the lyrics for", lyrics))

```


## Section Four Sophie 

```{r student4}

urlfunction <- function(year) {
  if (year == 1958 || (year >= 2012 && year <= 2023)) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Billboard_number-one_country_songs_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, "td:nth-child(3) .fn a , th+ td > a")
  }else if (year >= 1959 && year <= 1961){
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_C%26W_Sides_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter span a , .jquery-tablesorter th a")
  }else if (year >= 1962 && year <= 1989) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".fn a , td > a")
  }else if (year >= 1990 && year <= 2004) {
      country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Singles_%26_Tracks_number_ones_of_",  year)
      html <- read_html(country_url)
      cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }else { 
    country_url <- paste0("https://en.wikipedia.org/wiki/List_of_Hot_Country_Songs_number_ones_of_",  year)
    html <- read_html(country_url)
    cast <- html_nodes(html, ".jquery-tablesorter th+ td a , .jquery-tablesorter th a")
  }  

  html_text(cast, trim = TRUE) 
  tables <- html_table(html, fill = TRUE, header = TRUE)
  desired_table <- tables[[1]]
  desired_table <- desired_table[, c(2, 3)]
    #include only the second and third columns which are title and artist
  if ("Title" %in% desired_table[1, ]) {
    desired_table <- desired_table[-1, ]
    #get rid of top row if they have an extra header row
          }
  colnames(desired_table) <- c("Title", "Artist")
    #name columns
  desired_table$Year <- year
     #add columns for year
  desired_table$genre <- "Country" 
     #add column for genre
  desired_table <- unique(desired_table)
    #get rid of repeat columns
  return(desired_table)
      
}
TopSongs <- data.frame()
for(year in 1958:2023){
    current_year <- urlfunction(year)
    TopSongs <- rbind(TopSongs, current_year)
}
TopSongs$Title<-gsub("/.*", "", TopSongs$Title)
TopSongs$Title<-gsub('"', '', TopSongs$Title)
Topsongs2 <- replace(TopSongs," " , "-")

lyrics <- function(title, artist) {
lyric_url <- paste0("https://www.songlyrics.com/", artist, "/", title,"-lyrics/")
html <- read_html(lyric_url)
cast <- html_nodes(html, "#songLyricsDiv")
}
TopSongs2 <- sapply(TopSongs, function(x) gsub(" ", "-", x))
lyrics(let-her-cry, hootie-the-blowfish)
```
